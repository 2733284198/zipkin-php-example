# Highly inspired in https://blog.wyrihaximus.net/2016/11/running-php-unit-tests-on-windows-using-appveyor-and-chocolatey/

build: false
platform:
  - x64
clone_folder: c:\projects\zipkin-php-example

environment:
  matrix:
  - php_ver_target: 7.1
  - php_ver_target: 7.2
  - php_ver_target: 7.3

cache:
#    - '%LOCALAPPDATA%\Composer\files -> composer.lock'
    - composer.phar

init:
    - SET COMPOSER_NO_INTERACTION=1

## Install PHP and composer, and run the appropriate composer command
install:
    - ps: Invoke-WebRequest "https://raw.githubusercontent.com/ChadSikorra/ps-install-php/master/Install-PHP.ps1" -OutFile "Install-PHP.ps1"
    - ps: .\Install-PHP.ps1 -Version $Env:php_ver_target -Highest -Arch x64 -Extensions mbstring,intl,openssl,curl
    - rm .\Install-PHP.ps1
    - refreshenv
    - php -r "readfile('https://getcomposer.org/installer');" | php
    - cd c:\projects\zipkin-php-example
    - composer.phar install --no-progress --profile

## Run the actual test
test_script:
    - cd c:\projects\zipkin-php-example
